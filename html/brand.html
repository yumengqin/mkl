<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title></title>
	<link rel="stylesheet" href="../css/bootstrap.min.css">
	<link rel="stylesheet" href="../css/common.css">
	<link rel="stylesheet" href="../css/brand.css">
	<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
	<script src="../js/jquery.js"></script>

	<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
	<script src="../js/bootstrap.min.js"></script>
	<script src="../js/jquery.cookie.js"></script>
	<script src="../js/public.js"></script>
	
</head>
<body>
<!-- sear_box搜索框 -->
<div class="sear_box">
	<form>
		<div class="input-group has-feedback">
     		<input type="text" class="form-control" placeholder="热门搜索：洁面 控油 祛痘">
     		<ul class="sear-list p0"></ul>
     		<span class="input-group-btn">
       			<button class="btn btn-default p0" type="button">搜索</button>
     		</span>
     		<span class="glyphicon glyphicon-remove-circle form-control-feedback"></span>
     		<span class="clo"></span>
   		 </div>
	</form>
</div>

<!--右侧栏right_bar-->
<ul class="right_bar pl0">
	<li class="service"><a href="###"><img src="../images/side/rightSider_01.png" alt=""></a></li>
	<li class="tel">
		<img src="../images/side/rightSider_02.png" alt="">
		<img class="lastImg" src="../images/side/kefu1.png" alt="">
	</li>
	<li class="back"><a href="###"><img src="../images/side/rightSider_03.png" alt=""></a></li>
</ul>
<div class="content-wrapper">
	<!--遮罩层mask-->
	<div class="mask">
		<div class="mask-blank"></div>
		<div class="mask-mes">
			<span class="mask-close index-bg"></span>
			<p class="index-bg">商品已成功加入购物车</p>
			<p class="mask-btn">
				<a href="shopCar.html" class="go">去结算</a>
				<a href="javascript:;" class="aigin">继续购物</a>
			</p>
		</div>
	</div>

	<!-- content主体 -->
	<div class="content">
		<!--side_bar侧边栏-->
		<div class="side_bar">
			<ul class="pl0 side_bar_ul">
				<li><a href="../index.html">首&nbsp;页</a></li>
				<li><a href="###">品牌系列</a>
					<ul class="brandmenu pl0">
					</ul>
				</li>
				<li><a href="prolist.html?美容护肤">美容护肤</a></li>
				<li><a href="prolist.html?健康养生">健康养生</a></li>
				<li><a href="prolist.html?家居日用">家居日用</a></li>
				<li><a href="###">积分换购</a></li>
				<li><a href="###" class="lh22">VIP<br>会员专区</a></li>
				<li><a href="###">电子刊物</a></li>
				<li><a href="###">关于麦考林</a></li>
			</ul>
		</div>
		<!--header头部-->
		<div class="header">
			<h1 class="logo p0 col-md-6"><img src="../images/logo/newlogo.png" alt=""></h1>
			<div class="col-md-6">
				<ul class="header_list p0">
					<li><a class="h_ser index-bg" href="javascript:;"></a></li><span>|</span>
					<li><a class="h_login" href="login.html">登录</a></li><span>|</span>
					<li><a class="h_register" href="regist.html">注册</a></li><span>|</span>
					<li><a class="h_out" href="javascript:;">退出</a></li><span>|</span>
					<li><a class="h_my" href="javascript:;">我的账户</a></li><span>|</span>
					<li>
						<a class="h_car index-bg" href="shopCar.html"></a>
						<b class="h_carnum">0</b>
					</li>
					<li><img src="../images/logo/tel-call.png" alt=""></li>
				</ul>
			</div>
		</div>
		<!--brand_ban-->
		<div class="brand_ban">
			<div class="intro"></div>
		</div>
		<!--sell-well-->
		<div class="sell-well">
			<ul class="sell-well-list p0">
				<div class="left"></div>
				<div class="right"></div>
			</ul>
		</div>
		
		<!--product-->
		<div class="product">
			<h3 class="product-tit">
				<span>适用群族</span>
				<ul class="range left p0">
				</ul>
			</h3>
			<div class="pro-item">
				<ul class="pro-list p0">
					
				</ul>
				<div class="page-btn">
					
				</div>
			</div>
		</div>
	</div>
	
		
	<!--底部footer-->
	<div class="footer">
		<div class="foot-item1">
			<ul class="foot-list1">
				<li><a href="javascript:;"></a><span>100%正品保证</span></li>
				<li><a href="javascript:;"></a><span>专业在线客服</span></li>
				<li><a href="javascript:;"></a><span>满99包邮</span></li>
			</ul>
			<div class="foot-list2">
				<ul>
					<h3>新手指南</h3>
					<li><a href="###">新会员注册</a></li>
					<li><a href="###">购物演示</a></li>
					<li><a href="###">常见问题</a></li>
				</ul>	
				<ul>
					<h3>付款方式</h3>
					<li><a href="###">银行卡支付</a></li>
					<li><a href="###">支付宝支付</a></li>
					<li><a href="###">余额支付</a></li>
				</ul>	
				<ul>
					<h3>售后服务</h3>
					<li><a href="###">退换货政策</a></li>
					<li><a href="###">退换货流程</a></li>
					<li><a href="###">退款说明</a></li>
					<li><a href="###">发票说明</a></li>
				</ul>	
				<ul>
					<h3>特色服务</h3>
					<li><a href="###">贵宾专区</a></li>
					<li><a href="###">电子刊物</a></li>
					<li><a href="###">在线客服</a></li>
				</ul>
				<ul>
					<h3>麦考林生活家</h3>
					<li>
						<img src="../images/foot/dingyue.jpg" alt="">
					</li>
				</ul>	
				<ul>
					<h3>麦考林服务号</h3>
					<li>
						<img src="../images/foot/fuwu.jpg" alt="">
					</li>
				</ul>	
			</div>
		</div>
		<div class="foot-item2">
			<ul>
				<li><a href="###">关于麦考林</a></li>
				<li><a href="###">INVESTOR RELATIONS</a></li>
				<li><a href="###">联系我们</a></li>
				<li><a href="###">服务中心</a></li>
				<li><a href="###">加入我们</a></li>
			</ul>
			<p>
				<img src="../images/foot/newicon.png" alt="">
				 沪ICP备05003606号Copyright©2011-2015 MecoxLane Inc. All Rights Reserved
			</p>
			<p>
				<a href="###"><img src="../images/foot/evaluate.jpg" alt=""></a>
				<a href="###"><img src="../images/foot/beian.png" alt="">沪公网安备 31010402000234号</a>
			</p>
		</div>	
	</div>
</div>
</body>
<script>
	$(function () {
		var browser=navigator.appName
		var b_version=navigator.appVersion
		var version=b_version.split(";");
		var trim_Version=version[1].replace(/[ ]/g,"");
		
		var cname = "";
		var cid = window.location.search.replace("?","");
		var pageNum = 16;
		var pageIndex=0;
		var num = 0;
		var height = $(window).height()/2;
		var user = "";
		if(sessionStorage.getItem("now")){
			user = sessionStorage.getItem("now");
			var total = parseInt(localStorage.getItem("total"+user)) || 0;
			//购物车cookie
			if(localStorage.getItem("cart"+user)){
				var obj = JSON.parse(localStorage.getItem("cart"+user));
			}
			else{
				var obj = {};
			}
		}
		else{
			var total =parseInt(sessionStorage.getItem("total")) || 0;
			//购物车cookie
			if(sessionStorage.getItem("cart")){
				var obj = JSON.parse(sessionStorage.getItem("cart"));
			}
			else{
				var obj = {};
			}
		}
		$(".h_carnum").html(total);
		
		//获取左侧品牌的数据
		$.get('../brandlist.json', function(data) {
			var data = data.result;
			var brand = "<div></div>";
			$.each(data,function(index, el) {
				if(el.banner){
					brand += "<li><a href='brand.html?"+el.cid+"'>"+el.className+"</a></li><div></div>";
				}
				$(".brandmenu").html(brand);
				getWell(el);
				//设置title
		 
				if(!(browser=="Microsoft Internet Explorer" && trim_Version=="MSIE8.0")){
					$("title").html("麦考林--"+cname+"产品"); //Ie8不可以
				}
				//切换列表
				$(".range").on("click",".range_no",function(){
					getProlist(pageNum,pageIndex);
				});
				$(".range").on("click",".range_btn",function(){
					getProlist(pageNum,pageIndex,$(this).text());
				});
			});
		});
		
		
		//点击加入购物车
		$(".pro-list").on("click",".addCar",function(){
			total ++;
			var pnum = obj[$(this).attr("pid")] || 0;
			obj[$(this).attr("pid")] = ++pnum;
			var objToStr = JSON.stringify(obj);
			if(user==""){
				sessionStorage.setItem("cart",objToStr);
				sessionStorage.setItem("total",total);
			}
			else{
				localStorage.setItem("cart"+user,objToStr);
				localStorage.setItem("total"+user,total);
			}
			console.log(obj)
			$(".h_carnum").html(total);
			$(".mask").show();
			$(".mask-mes").animate({
				top: height
			});
		});
		$(".mask-close").click(function(){
			$(".mask").fadeOut(function(){$(".mask-mes").css("top","-200px");});
		});
		$(".aigin").click(function(){
			$(".mask").fadeOut(function(){$(".mask-mes").css("top","-200px");});
		});
		
		
		//翻页功能
		getProlist(pageNum,pageIndex);
		$(".page-btn").on("click",".fp",function(){
			pageIndex=0;
			getProlist(pageNum,pageIndex);
		});
		$(".page-btn").on("click",".pre",function(){
			pageIndex--;
			getProlist(pageNum,pageIndex);
		});
		$(".page-btn").on("click",".next",function(){
			pageIndex++;
			getProlist(pageNum,pageIndex);
		});
		$(".page-btn").on("click",".lp",function(){
			pageIndex=num;
			getProlist(pageNum,pageIndex);
		});
		$(".page-btn").on("click","li",function(){
			pageIndex=$(this).index();
			getProlist(pageNum,pageIndex);
		});
		function getWell(el){
			var intro = "";
			var rangeStr = "<li class='range_no'><a href='javascript:;'> 不限 </a></li>";
			var sellwellL = "";
			var sellwellR = "";
			if(el.cid == cid){
				cname = el.className;
				intro += "<h2>"+el.className+"</h2><p>"+el.intro+"</p>";
				$.each(el.hot,function(index, el) {
					if(index==0){
						sellwellL += "<a href='info.html?"+el.pid+"'>"+
										"<img src='"+el.banImg+"'>"+
										"</a>"
					}
					else{
						sellwellR += "<li><a href='info.html?"+el.pid+"'>"+
									"<img src='"+el.banImg+"'>"+
									"</a></li>"
					}
					
				});
				$.each(el.important, function(index,value) {
					if(value){
						rangeStr += "<li class='range_btn'><a href='javascript:;'>"+value.title+"</a></li>"
					}
					$(".range").html(rangeStr);
				});
				$(".sell-well-list .left").html(sellwellL);
				$(".sell-well-list .right").html(sellwellR);
				$(".sell-well-list .right li").eq(0).find("a").css("padding-right","10px");
				$(".sell-well-list .right li").eq(2).find("img").css("width","566px");
				$(".intro").html(intro);
				$(".brand_ban").css({
					background: "url("+el.banner+") no-repeat center top"
				})
			}
		}
		function getProlist(pageNum,index,sel_mes){
			var listStr = "";
			$(".page-btn").html("<a href='javascript:;' class='w60 fp'>首页</a>"+
					"<a href='javascript:;' class='w60 pre'>上一页</a>"+
					"<ul class='page-list p0'>"+
					"</ul>"+
					"<a href='javascript:;' class='w60 next'>下一页</a>"+
					"<a href='javascript:;' class='w60 lp'>尾页</a>");
			$.get('../proinfo.json', function(data) {
				var data = data.result;
				var pro = [];
				$.each(data, function(index,el) {
					if(el.brand == cname){
						if(sel_mes){
							var re = new RegExp(sel_mes);
							if(re.test(el.key_word)){
								if(!el.tel){
									pro.push(el);
								}
							}
						}
						else{
							if(!el.tel){
								pro.push(el);
							}
						}
						
					}
				});
				num = Math.ceil(pro.length/pageNum);
				if(num == 0 || num == 1){
					$(".fp").remove();
					$(".pre").remove();
					$(".next").remove();
					$(".lp").remove();
				}
				var page = "";
				for(var i = 1; i <= num; i++){
					page += "<li><a href='javascript:;'>"+i+"</a></li>";
				}
				$(".page-list").html(page);
				$(".page-list li a").eq(index).addClass("active");
				if(index==0){
					$(".fp").remove();
					$(".pre").remove();
				}
				if(index == (num-1)){
					$(".next").remove();
					$(".lp").remove();
				}
				var max = Math.min(pro.length,(index+1)*pageNum)
				for(var i = index*pageNum; i<max ;i++){
					listStr += "<li><a href='info.html?"+pro[i].pid+"'>"+
							"<p><img src='"+pro[i].showimg+"'></p>"+
							"<h3>"+pro[i].title+"</h3></a>"+
							"<strong> ￥ "+pro[i].price+"</strong>"+
							"<span class='addCar index-bg' pid='"+pro[i].pid+"'></span>"+
							"</li>";
				}
				$(".pro-list").html(listStr);
				
			});
		}
	});
</script>
</html>